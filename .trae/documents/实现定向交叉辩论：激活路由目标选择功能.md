# 实现多源引用与内置指令 (Multi-Source Quote & Presets)

根据您的详细需求，我们将对 Router Dock 进行全面升级，使其支持多引用、自动排除和一键指令。

## 1. UI 升级 (UI Enhancement)
### 1.1 引用区 (`panel.html` & `panel.css`)
*   将 `#quote-preview` 改造为 `#quote-list` 容器。
*   每条引用显示为独立的 Block，包含：
    *   来源标签 (如 "From: ChatGPT")
    *   摘要文本
    *   独立的删除按钮 (×)
*   新增 "Clear All" 按钮。

### 1.2 指令区 (Preset Chips)
*   在输入框上方新增一组 "Preset Chips"（指令胶囊）。
*   内容：
    *   🛑 找漏洞 (Red Teaming)
    *   🔍 查数据 (Fact Check)
    *   🔄 唱反调 (Devil's Advocate)
    *   🛠️ 谈落地 (Execution)
    *   ⚖️ 做平衡 (Trade-off)
*   交互：点击胶囊，自动将对应的详细 prompt 填入输入框。

## 2. 逻辑实现 (`panel.js`)
### 2.1 多引用管理
*   新增 `quoteList` 数组维护当前引用的内容。
*   `quoteContent(source, text)` 改为 `addQuote(source, text)`：
    *   将新引用 push 到数组。
    *   重新渲染 UI 列表。
    *   **自动排除逻辑**：遍历 `quoteList`，获取所有 source，然后自动禁用底部对应的 checkbox。

### 2.2 路由发送
*   `simulateRoute()`:
    *   不再只发单条 quote，而是将 `quoteList` 拼接成多段文本：
        ```text
        [Reference 1 - ChatGPT]
        ...
        [Reference 2 - Claude]
        ...
        ```
    *   **关键修复**：收集底部 checkbox 的状态，生成 `targets` 数组，传给后台。

### 2.3 后台逻辑 (`service_worker.js`)
*   更新 `routeMessage`：
    *   支持接收 `targets` 参数。
    *   如果 `targets` 存在，仅发送给指定模型。
    *   如果 `targets` 为空，保留原来的全员广播（Fallback）。

---
**确认执行后，我将按此计划升级您的控制台。**